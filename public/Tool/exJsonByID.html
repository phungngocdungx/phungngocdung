<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>TikTok Username Extractor</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f9f9f9;
    }

    input,
    button {
      margin-top: 1em;
      margin-right: 1em;
    }

    pre {
      background: #eee;
      padding: 1em;
      white-space: pre-wrap;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <h2>üì¶ Tool Extract TikTok Usernames t·ª´ nhi·ªÅu file JSON</h2>

  <input type="file" id="fileInput" accept=".json" multiple />
  <br />
  <button onclick="downloadJSON()">‚¨áÔ∏è T·∫£i k·∫øt qu·∫£ .json</button>
  <button onclick="copyOutput()">üìã Copy to√†n b·ªô</button>

  <h3>K·∫øt qu·∫£:</h3>
  <pre id="output">Ch∆∞a c√≥ d·ªØ li·ªáu</pre>

  <script>
    let extracted = [];

    document.getElementById('fileInput').addEventListener('change', function (e) {
      const files = e.target.files;
      if (!files.length) return;

      extracted = []; // reset d·ªØ li·ªáu
      let filesProcessed = 0;
      let totalOutput = [];

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function (event) {
          try {
            const json = JSON.parse(event.target.result);
            const data = json.data || [];

            const results = data.map(item => {
              const match = item.link?.match(/tiktok\.com\/@([\w\._\-]+)/i);
              return match ? { id: match[1] } : null;
            }).filter(Boolean);

            extracted = extracted.concat(results);
            totalOutput = totalOutput.concat(results.map(obj => JSON.stringify(obj)));

            filesProcessed++;
            if (filesProcessed === files.length) {
              const count = extracted.length;
              const header = `‚úÖ ƒê√£ tr√≠ch xu·∫•t ${count} username:\n\n`;
              document.getElementById('output').textContent = header + totalOutput.join(",\n");
            }

          } catch (err) {
            document.getElementById('output').textContent = "‚ùå JSON kh√¥ng h·ª£p l·ªá trong file: " + file.name + "\n" + err.message;
          }
        };
        reader.readAsText(file);
      });
    });

    function downloadJSON() {
      if (!extracted.length) {
        alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i!");
        return;
      }
      const blob = new Blob([JSON.stringify(extracted, null, 2)], { type: "application/json" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "tiktok_usernames.json";
      link.click();
    }

    function copyOutput() {
      const text = document.getElementById('output').textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("‚úÖ ƒê√£ copy to√†n b·ªô k·∫øt qu·∫£!");
      }).catch(err => {
        alert("‚ùå L·ªói khi copy: " + err);
      });
    }
  </script>
</body>

</html>